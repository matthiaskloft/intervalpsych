n_cores = 1,
iter_sampling = 50,
iter_warmup = 50,
adapt_delta = .8
)
)
summary <- summary(fit)
expect_s3_class(summary, "data.frame")
expect_true(nrow(summary) > 0)
expect_true(ncol(summary) > 0)
expect_true(all(c("T_L_median",
"T_L_CI_025",
"T_L_CI_975",
"T_U_median",
"T_U_CI_025",
"T_U_CI_975"
) %in% colnames(summary)))
})
test_that("plot works correctly", {
suppressWarnings(
fit <-
intervalpsych::fit_itm(
df_simplex = extraDistr::rdirichlet(25, c(2,2,2)) |> as.data.frame(),
id_person = rep(1:5,5),
id_item = rep(1:5, each = 5),
n_chains = 1,
n_cores = 1,
iter_sampling = 50,
iter_warmup = 50,
adapt_delta = .8
)
)
plot <- plot(fit)
expect_s3_class(plot, "ggplot")
})
covr::report()
install.packages("covr")
covr::report()
c <- covr::package_coverage()
c <- covr::report()
covr::report(x = package_coverage(quiet = FALSE))
covr::report(x = covr::package_coverage(quiet = FALSE))
devtools::load_all()
install.packages("devtools")
devtools::load_all()
library(intervalpsych)
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>",
fig.path = "man/figures/README-",
out.width = "90%",
fig.width = 10,
fig.height = 10,
message = FALSE
)
library(intervalpsych)
install.packages(c('extraDistr', 'ggdist'))
source("~/GitHub/Interval_Projects/intervalpsych/tests/testthat/test-summary_itm_stanfit.R", echo=TRUE)
library(intervalpsych)
library(dplyr)
library(kableExtra)
data(quantifiers)
quantifiers <- quantifiers |>
# exclude control items
dplyr::filter(!name_en %in% c("always", "never", "fifty-fifty chance")) |>
# sample 100 respondents
dplyr::filter(id_person %in% sample(
size = 30,
replace = FALSE,
unique(quantifiers$id_person)
)) |>
# exclude missing values
dplyr::filter(!is.na(x_L) & !is.na(x_U)) |>
# recompute IDs
dplyr::mutate(
id_person = factor(id_person) |> as.numeric(),
id_item = factor(id_item) |> as.numeric()
)
head(quantifiers) |>
kable(digits = 2) |>
kable_styling()
#| fig.alt: >
#|  Cumulative distribution of interval responses.
plot_intervals_cumulative(
lower = quantifiers$x_L,
upper = quantifiers$x_U,
min = quantifiers$scale_min,
max = quantifiers$scale_max,
cluster_id = quantifiers$name_en,
weighted = TRUE
)
quantifiers <- cbind(
quantifiers,
itvl_to_splx(quantifiers[,c("x_L","x_U")], min = quantifiers$scale_min, max = quantifiers$scale_max))
head(quantifiers[,9:13]) |>
round(2) |>
kable() |>
kable_styling()
try(ilr(quantifiers[,c("x_1","x_2","x_3")]))
quantifiers[, c("x_1", "x_2", "x_3")] <-
remove_zeros(quantifiers[, c("x_1", "x_2", "x_3")], padding = 0.01)
head(quantifiers[,9:13]) |>
round(2) |>
kable() |>
kable_styling()
fit <-
fit_itm(
df_simplex = quantifiers[, c("x_1", "x_2", "x_3")],
id_person = quantifiers$id_person,
id_item = quantifiers$id_item,
item_labels = quantifiers |>
dplyr::distinct(id_item, name_en) |>
dplyr::pull(name_en),
n_chains = 2,
n_cores = 2,
iter_sampling = 1000,
iter_warmup = 300,
adapt_delta = .95
)
devtools::load_all()
fit <-
fit_itm(
df_simplex = quantifiers[, c("x_1", "x_2", "x_3")],
id_person = quantifiers$id_person,
id_item = quantifiers$id_item,
item_labels = quantifiers |>
dplyr::distinct(id_item, name_en) |>
dplyr::pull(name_en),
n_chains = 2,
n_cores = 2,
iter_sampling = 1000,
iter_warmup = 300,
adapt_delta = .95
)
fit <-
fit_itm(
df_simplex = quantifiers[, c("x_1", "x_2", "x_3")],
id_person = quantifiers$id_person,
id_item = quantifiers$id_item,
item_labels = quantifiers |>
dplyr::distinct(id_item, name_en) |>
dplyr::pull(name_en),
n_chains = 2,
n_cores = 2,
iter_sampling = 1000,
iter_warmup = 300,
adapt_delta = .95
)
consensus <- extract_consensus(fit, print_summary = FALSE)
attributes(consensus)
summary(fit) |>
kable() |>
kable_styling()
#| fig.alt: >
#|   Plot of the estimated consensus intervals.
plot(fit, method = "median_bounds")
#| fig.alt: >
#|   Plot of the estimated consensus intervals.
plot_consensus(fit, method = "draws_gradient", CI = 0, CI_gradient = .5)
#| fig.alt: >
#|   Plot of the estimated consensus intervals.
plot_consensus(fit, method = "draws_gradient", CI = 0)
plot_consensus(fit, method = "draws_gradient", CI = .9)
#| fig.alt: >
#|   Plot of the estimated consensus intervals.
plot_consensus(fit, method = "draws_gradient", CI = .9)
#| fig.alt: >
#|   Plot of the estimated consensus intervals.
plot_consensus(fit, method = "draws_gradient", CI = .95)
#| fig.alt: >
#|   Plot of the estimated consensus intervals.
plot_consensus(fit, method = "draws_gradient", CI = c(.9,1), CI_gradient = .9)
#| fig.alt: >
#|   Plot of the estimated consensus intervals.
plot_consensus(fit, method = "draws_distribution", CI = .95)
#| fig.alt: >
#|   Plot of the estimated consensus intervals.
plot_consensus(fit, method = "draws_distribution", CI = c(.9,1))
# Test for invalid input
test_that("splx_to_itvl transformation handles invalid input", {
expect_error(splx_to_itvl(c(0.4, 0.2), min = 0, max = 1), "Simplex must have 3 elements")
expect_error(splx_to_itvl(data.frame(rbind(c(0.1, 0.2), c(0.4, 0.5))), min = 0, max = 1), "Simplex must have 3 elements")
})
splx_to_itvl(data.frame(rbind(
c(0.1, 0.2), c(0.4, 0.5)
)), min = 0, max = 1)
devtools::load_all()
splx_to_itvl(data.frame(rbind(
c(0.1, 0.2), c(0.4, 0.5)
)), min = 0, max = 1)
expect_error(splx_to_itvl(data.frame(rbind(
c(0.1, 0.2), c(0.4, 0.5)
)), min = 0, max = 1),
"Simplex must have 3 elements")
pkgdown::build_site()
pkgdown::build_site()
install.packages("covr")
covr::package_coverage(quiet = F)
cov <- covr::package_coverage(quiet = F)
as.data.frame(cov)
View(cov)
test_that("gather_values works correctly with weighted = TRUE", {
lower <- c(1, 2, 3)
upper <- c(2, 3, 4)
cluster_id <- c(1, 2, 3)
weighted <- TRUE
n_samples <- 100
result <- gather_values(lower, upper, cluster_id, weighted, n_samples = n_samples)
expect_equal(nrow(result), length(lower) * n_samples)
expect_equal(ncol(result), 2)
expect_true(all(result$samples >= lower[1] & result$samples <= upper[3]))
expect_true(all(result$cluster_id %in% cluster_id))
})
covr::package_coverage(quiet = F)
covr::package_coverage(quiet = F)
covr::package_coverage(quiet = T)
covr::package_coverage(quiet = F)
covr::package_coverage(quiet = F)
test_that("remove_zeros works with a vector input", {
simplex <- c(0.2, 0.3, 0.5)
result <- remove_zeros(simplex)
expect_equal(result, simplex, tolerance = 1e-6)
})
library(testthat)
test_that("remove_zeros works with a vector input", {
simplex <- c(0.2, 0.3, 0.5)
result <- remove_zeros(simplex)
expect_equal(result, simplex, tolerance = 1e-6)
})
devtools::load_all()
test_that("remove_zeros works with a vector input", {
simplex <- c(0.2, 0.3, 0.5)
result <- remove_zeros(simplex)
expect_equal(result, simplex, tolerance = 1e-6)
})
test_that("remove_zeros works with a vector input", {
simplex <- c(0.2, 0.3, 0.5)
result <- remove_zeros(simplex)
expect_equal(result, simplex, tolerance = 1e-6)
})
test_that("remove_zeros works with a vector input", {
simplex <- c(0.2, 0.3, 0.5)
result <- sum(remove_zeros(simplex))
expect_equal(result, 1, tolerance = 1e-6)
})
test_that("remove_zeros works with a vector input", {
simplex <- c(0.2, 0.3, 0.5)
sum <- sum(remove_zeros(simplex))
has_zeros <- any(remove_zeros(simplex) == 0)
expect_equal(sum, 1, tolerance = 1e-6)
expect_equal(sum, TRUE)
})
expect_equal(has_zeros, TRUE)
sum <- sum(remove_zeros(simplex))
test_that("remove_zeros works with a matrix input", {
simplex <- matrix(c(0.2, 0.3, 0.5, 0, 0.5, 0.5), nrow = 2, byrow = TRUE)
sum <- sum(remove_zeros(simplex))
expect_equal(sum, 1, tolerance = 1e-6)
has_zeros <- any(remove_zeros(simplex) == 0)
expect_equal(has_zeros, TRUE)
})
test_that("remove_zeros works with a matrix input", {
simplex <- matrix(c(0.2, 0.3, 0.5, 0, 0.5, 0.5), nrow = 2, byrow = TRUE)
mean <- mean(remove_zeros(simplex))
expect_equal(sum, 1, tolerance = 1e-6)
has_zeros <- any(remove_zeros(simplex) == 0)
expect_equal(has_zeros, TRUE)
})
test_that("remove_zeros works with a matrix input", {
simplex <- matrix(c(0.2, 0.3, 0.5, 0, 0.5, 0.5), nrow = 2, byrow = TRUE)
sum <- sum(remove_zeros(simplex))
expect_equal(sum, 2, tolerance = 1e-6)
has_zeros <- any(remove_zeros(simplex) == 0)
expect_equal(has_zeros, FALSE)
})
test_that("remove_zeros works with a vector input", {
simplex <- c(0.2, 0.3, 0.5)
sum <- sum(remove_zeros(simplex))
expect_equal(sum, 1, tolerance = 1e-6)
has_zeros <- any(remove_zeros(simplex) == 0)
expect_equal(has_zeros, FALSE)
})
test_that("remove_zeros throws an error for non-numeric input", {
simplex <- matrix(c("a", "b", "c", "d"), nrow = 2, byrow = TRUE)
expect_error(remove_zeros(simplex), "Error: simplex must be numeric!")
})
test_that("remove_zeros throws an error for input not on unit scale", {
simplex <- matrix(c(0.2, 0.3, 0.6, 0, 0.5, 0.5), nrow = 2, byrow = TRUE)
expect_error(remove_zeros(simplex), "Error: simplex must be in the unit scale!")
})
test_that("remove_zeros throws an error for input rows not summing to one", {
simplex <- matrix(c(0.2, 0.3, 0.4, 0, 0.5, 0.5), nrow = 2, byrow = TRUE)
expect_error(remove_zeros(simplex), "Error: simplex must sum to 1!")
})
simplex <- matrix(c(-0.2, 0.1, 1.1, 0, 0.5, 0.5), nrow = 2, byrow = TRUE)
method <- "simple"
test_that("remove_zeros works with a vector input", {
simplex <- c(0.2, 0.3, 0.5)
sum <- sum(remove_zeros(simplex, method = method))
expect_equal(sum, 1, tolerance = 1e-6)
has_zeros <- any(remove_zeros(simplex, method = method) == 0)
expect_equal(has_zeros, FALSE)
})
method <- "simple"
test_that("remove_zeros works with a vector input", {
simplex <- c(0.2, 0.3, 0.5)
sum <- sum(remove_zeros(simplex, method = method))
expect_equal(sum, 1, tolerance = 1e-6)
has_zeros <- any(remove_zeros(simplex, method = method) == 0)
expect_equal(has_zeros, FALSE)
})
method <- "simple_replacement"
test_that("remove_zeros works with a vector input", {
simplex <- c(0.2, 0.3, 0.5)
sum <- sum(remove_zeros(simplex, method = method))
expect_equal(sum, 1, tolerance = 1e-6)
has_zeros <- any(remove_zeros(simplex, method = method) == 0)
expect_equal(has_zeros, FALSE)
})
test_that("remove_zeros works with a matrix input", {
simplex <- matrix(c(0.2, 0.3, 0.5, 0, 0.5, 0.5), nrow = 2, byrow = TRUE)
sum <- sum(remove_zeros(simplex, method = method))
expect_equal(sum, 2, tolerance = 1e-6)
has_zeros <- any(remove_zeros(simplex, method = method) == 0)
expect_equal(has_zeros, FALSE)
})
test_that("remove_zeros works with a data frame input", {
simplex <- data.frame(a = c(0.2, 0), b = c(0.3, 0.5), c = c(0.5, 0.5))
sum <- sum(remove_zeros(simplex, method = method))
expect_equal(sum, 2, tolerance = 1e-6)
has_zeros <- any(remove_zeros(simplex, method = method) == 0)
expect_equal(has_zeros, FALSE)
})
test_that("remove_zeros throws an error for non-numeric input", {
simplex <- matrix(c("a", "b", "c", "d"), nrow = 2, byrow = TRUE)
expect_error(remove_zeros(simplex), "Error: simplex must be numeric!")
})
test_that("remove_zeros throws an error for input not on unit scale", {
simplex <- matrix(c(-0.2, 0.1, 1.1, 0, 0.5, 0.5), nrow = 2, byrow = TRUE)
expect_error(remove_zeros(simplex), "Error: simplex must be in the unit scale!")
})
test_that("remove_zeros throws an error for input rows not summing to one", {
simplex <- matrix(c(0.2, 0.3, 0.4, 0, 0.5, 0.5), nrow = 2, byrow = TRUE)
expect_error(remove_zeros(simplex), "Error: simplex must sum to 1!")
})
# error for invalid method
test_that("remove_zeros throws an error for invalid method", {
expect_error(remove_zeros(c(0.2, 0.3, 0.5), method = "invalid_method"), "Error: method must be one of simple_replacement")
})
devtools::load_all()
# error for invalid method
test_that("remove_zeros throws an error for invalid method", {
expect_error(remove_zeros(c(0.2, 0.3, 0.5), method = "invalid_method"), "Error: method must be one of simple_replacement")
})
# error for invalid method
test_that("remove_zeros throws an error for invalid method", {
expect_error(remove_zeros(c(0.2, 0.3, 0.5), method = "invalid_method"), "Error: method must be one of simple_replacement")
})
method <- "simple_replacement"
test_that("remove_zeros works with a vector input", {
simplex <- c(0.2, 0.3, 0.5)
sum <- sum(remove_zeros(simplex, method = method))
expect_equal(sum, 1, tolerance = 1e-6)
has_zeros <- any(remove_zeros(simplex, method = method) == 0)
expect_equal(has_zeros, FALSE)
})
test_that("remove_zeros works with a matrix input", {
simplex <- matrix(c(0.2, 0.3, 0.5, 0, 0.5, 0.5), nrow = 2, byrow = TRUE)
sum <- sum(remove_zeros(simplex, method = method))
expect_equal(sum, 2, tolerance = 1e-6)
has_zeros <- any(remove_zeros(simplex, method = method) == 0)
expect_equal(has_zeros, FALSE)
})
test_that("remove_zeros works with a data frame input", {
simplex <- data.frame(a = c(0.2, 0), b = c(0.3, 0.5), c = c(0.5, 0.5))
sum <- sum(remove_zeros(simplex, method = method))
expect_equal(sum, 2, tolerance = 1e-6)
has_zeros <- any(remove_zeros(simplex, method = method) == 0)
expect_equal(has_zeros, FALSE)
})
test_that("remove_zeros throws an error for non-numeric input", {
simplex <- matrix(c("a", "b", "c", "d"), nrow = 2, byrow = TRUE)
expect_error(remove_zeros(simplex), "Error: simplex must be numeric!")
})
test_that("remove_zeros throws an error for input not on unit scale", {
simplex <- matrix(c(-0.2, 0.1, 1.1, 0, 0.5, 0.5), nrow = 2, byrow = TRUE)
expect_error(remove_zeros(simplex), "Error: simplex must be in the unit scale!")
})
test_that("remove_zeros throws an error for input rows not summing to one", {
simplex <- matrix(c(0.2, 0.3, 0.4, 0, 0.5, 0.5), nrow = 2, byrow = TRUE)
expect_error(remove_zeros(simplex), "Error: simplex must sum to 1!")
})
covr::package_coverage(qiet = F)
covr::package_coverage(qiet = F)
71.58 + (-5*1.16) + (11*-.67) + .51
covr::code_coverage(quiet = F)
covr::code_coverage(quiet = T)
covr::code_coverage(quiet = F)
covr::code_coverage(quiet = F)
covr::code_coverage(quiet = F)
covr::code_coverage(quiet = T)
covr::package_coverage(quiet = F)
covr::package_coverage(quiet = F)
covr::package_coverage(quiet = F)
test_that("fit_itm works correctly", {
suppressWarnings(
fit <-
intervalpsych::fit_itm(
df_simplex = extraDistr::rdirichlet(25, c(2,2,2)) |> as.data.frame(),
id_person = rep(1:5,5),
id_item = rep(1:5, each = 5),
n_chains = 1,
n_cores = 1,
iter_sampling = 50,
iter_warmup = 50,
adapt_delta = .8
)
)
expect_s3_class(fit, "list")
expect_s3_class(fit, "itm_fit")
expect_true(all(c("stan_fit", "stan_data", "item_labels") %in% names(fit)))
})
library(testthat)
test_that("fit_itm works correctly", {
suppressWarnings(
fit <-
intervalpsych::fit_itm(
df_simplex = extraDistr::rdirichlet(25, c(2,2,2)) |> as.data.frame(),
id_person = rep(1:5,5),
id_item = rep(1:5, each = 5),
n_chains = 1,
n_cores = 1,
iter_sampling = 50,
iter_warmup = 50,
adapt_delta = .8
)
)
expect_s3_class(fit, "list")
expect_s3_class(fit, "itm_fit")
expect_true(all(c("stan_fit", "stan_data", "item_labels") %in% names(fit)))
})
suppressWarnings(
fit <-
intervalpsych::fit_itm(
df_simplex = extraDistr::rdirichlet(25, c(2,2,2)) |> as.data.frame(),
id_person = rep(1:5,5),
id_item = rep(1:5, each = 5),
n_chains = 1,
n_cores = 1,
iter_sampling = 50,
iter_warmup = 50,
adapt_delta = .8
)
)
expect_s3_class(fit, "list")
expect_s3_class(fit, "itm_stanfit")
expect_true(all(c("stan_fit", "stan_data", "item_labels") %in% names(fit)))
test_that("fit_itm works correctly", {
suppressWarnings(
fit <-
intervalpsych::fit_itm(
df_simplex = extraDistr::rdirichlet(25, c(2,2,2)) |> as.data.frame(),
id_person = rep(1:5,5),
id_item = rep(1:5, each = 5),
n_chains = 1,
n_cores = 1,
iter_sampling = 50,
iter_warmup = 50,
adapt_delta = .8
)
)
expect_s3_class(fit, "list")
expect_s3_class(fit, "itm_stanfit")
expect_true(all(c("stan_fit", "stan_data", "item_labels") %in% names(fit)))
})
suppressWarnings(
fit <-
intervalpsych::fit_itm(
df_simplex = extraDistr::rdirichlet(25, c(2,2,2)) |> as.data.frame(),
id_person = rep(1:5,5),
id_item = rep(1:5, each = 5),
n_chains = 1,
n_cores = 1,
iter_sampling = 50,
iter_warmup = 50,
adapt_delta = .8
)
)
plot <- intervalpsych::plot_consensus(fit)
class(plot)
plot <- intervalpsych::plot_consensus(fit)
expect_s3_class(plot, "ggplot")
test_that("plot_consensus works correctly", {
suppressWarnings(
fit <-
intervalpsych::fit_itm(
df_simplex = extraDistr::rdirichlet(25, c(2,2,2)) |> as.data.frame(),
id_person = rep(1:5,5),
id_item = rep(1:5, each = 5),
n_chains = 1,
n_cores = 1,
iter_sampling = 50,
iter_warmup = 50,
adapt_delta = .8
)
)
plot <- intervalpsych::plot_consensus(fit)
expect_s3_class(plot, "ggplot")
})
covr::package_coverage(quiet = F)
covr::package_coverage(quiet = F)
covr::package_coverage(quiet = F, type = "all")
